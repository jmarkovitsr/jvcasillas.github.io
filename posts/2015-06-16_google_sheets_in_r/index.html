<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

<!--   
  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://jvcasill.github.io">
  <meta name="twitter:title" content="How to scrape data from Google Sheets in R">
  <meta name="twitter:description" content="">
  <meta name="twitter:image" content="http://jvcasill.github.io/images/jvcasill.jpg">
  <meta name="twitter:site" content="@jvcasill">
  <meta name="twitter:creator" content="@jvcasill">
   -->
  
  <head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  
    <title>
        Joseph V. Casillas
      </title>
  
    <!-- CSS -->
    <link rel="stylesheet" href="../../libraries/frameworks/lanyon/public/css/poole.css">
    <link rel="stylesheet" href="../../libraries/frameworks/lanyon/public/css/syntax.css">
    <link rel="stylesheet" href="../../libraries/frameworks/lanyon/public/css/lanyon.css">
    <link rel="stylesheet" href="../../libraries/highlighters/highlight.js/css/googlecode.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
    <link rel='stylesheet' href='//fonts.googleapis.com/css?family=Gentium+Book+Basic|Lato:400' type='text/css'>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <link rel="stylesheet" href="../../libraries/frameworks/lanyon/public/css/buttons.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Maven+Pro">
  
  
  
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../libraries/frameworks/lanyon/public/praat.png">
    <link rel="shortcut icon" href="../../libraries/frameworks/lanyon/public/favicon_ipa.ico">
  
    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  
    <!-- Jquery -->
    <script type="text/javascript" src="../../libraries/frameworks/lanyon/public/js/jquery-1.7.2.min.js"></script>
  
    <!-- Javascript -->
    <script type="text/javascript" src="../../libraries/frameworks/lanyon/public/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../libraries/frameworks/lanyon/public/js/bootstrap-dropdown.js"></script>
    
    <!-- Source: http://developerdrive.developerdrive.netdna-cdn.com/wp-content/uploads/2013/07/scroll-to-top.html 
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
  
    <style>
  	.back-to-top {
  		position: fixed;
  		bottom: 2em;
  		right: 5px;
  		text-decoration: none;
  		color: #000000;
  		background-color: rgba(235, 235, 235, 0.80);
  		font-size: 12px;
  		padding: 1em;
  		display: none;
  	}
  
  	.back-to-top:hover {	
  		background-color: rgba(135, 135, 135, 0.50);
  	}	
  	</style>
    -->
  
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
      ga('create', 'UA-49437230-1', 'jvcasillas.com');
      ga('send', 'pageview');
  
    </script>
  
  
    <script type="text/javascript" language="JavaScript">
    function HideContent(d) {
    document.getElementById(d).style.display = "none";
    }
    function ShowContent(d) {
    document.getElementById(d).style.display = "block";
    }
    function ReverseDisplay(d) {
    if(document.getElementById(d).style.display == "none") { document.getElementById(d).style.display = "block"; }
    else { document.getElementById(d).style.display = "none"; }
    }
    </script>
    
  </head>  
  

  <body class='theme-base-01 '>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
         styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">
    
    <!-- Toggleable sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-item">
        <h2>Joseph V. Casillas</h2>
        <p>PhD Candidate</br>
        University of Arizona</p>
    
    
        <a href="mailto:jvcasill@email.arizona.edu"><span class="mail me" title="email"><img src="../../libraries/frameworks/lanyon/assets/images/icons/mail_white.png" alt="info image" height="30" width="26" style="float:left;"></span></a>
        <a alt="youtube" href="http://www.youtube.com/jvcasill" target='_new'><span class="showtooltip" title="youtube channel"><img src="../../libraries/frameworks/lanyon/assets/images/icons/youtube_white2.png" alt="info image" height="30" width="30" style="float:left;"></span></a>
        <a alt="twitter" href="http://twitter.com/jvcasill/" target='_new'><span class="showtooltip" title="my twitter feed"><img src="../../libraries/frameworks/lanyon/assets/images/icons/twitter_white.png" alt="bird image" height="30" width="30" style="float:left;"></span></a>
        <a alt="facebook" href="http://facebook.com/jvcasill/" target='_new'><span class="showtooltip" title="more info"><img src="../../libraries/frameworks/lanyon/assets/images/icons/fb_white.png" alt="info image" height="30" width="30" style="float:left;"></span></a>
        <a alt="github" href="http://github.com/jvcasill/" target='_new'><span class="showtooltip" title="my code"><img src="../../libraries/frameworks/lanyon/assets/images/icons/github_white2.png" alt="github image" height="30" width="30" style="float:left;"></span></a>
        <a alt="researchgate" href="https://www.researchgate.net/profile/Joseph_Casillas" target='_new'><span class="showtooltip" title="researchgate"><img src="../../libraries/frameworks/lanyon/assets/images/icons/rg_white.png" alt="rss image" height="30" width="30" style="float:left;"></span></a></br>
      </div>
    
      <nav class="sidebar-nav">
        <a class="sidebar-nav-item" href="/">
          <i class='fa fa-home'> </i>  home
        </a>
        <!-- <a class="sidebar-nav-item" href="/archive/v.zip">
          <i class='fa fa-download'> </i>  Download
        </a> -->
        <a class="sidebar-nav-item" href="/bio">
      <i class='fa fa-puzzle-piece'> </i>  bio
    </a>
    <a class="sidebar-nav-item" href="/teaching">
      <i class='fa fa-pencil-square'> </i>  teaching
    </a>
    <a class="sidebar-nav-item" href="/research">
      <i class='fa fa-cogs'> </i>  research
    </a>
    <a class="sidebar-nav-item" href="/cv">
      <i class='fa fa-puzzle-piece'> </i>  cv
    </a>
    <a class="sidebar-nav-item" href="/code">
      <i class='fa fa-code'> </i>  code
    </a>
    <a class="sidebar-nav-item" href="/blog">
      <i class='fa fa-archive'> </i>  blog
    </a>
    <!-- <span class="sidebar-nav-item">Currently v</span> -->
      </nav>
    
      <div class="sidebar-item">
        <p>
          &copy; 2015. All rights reserved.
        </p>
      </div>
    </div>    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <label for="sidebar-checkbox" class="sidebar-toggle"></label>

          <h2 class="masthead-title">
            <a href="/" title="Home">Joseph V. Casillas</a>
            <small></small>
<!--             <div style='float:right;'>
            <a href="/blog">
              <i class='fa fa-archive'> </i>
            </a>
            <a href="http://twitter.com/jvcasill">
              <i class='fa fa-twitter'> </i>
            </a>
            <a href="http://github.com/jvcasill">
              <i class='fa fa-github'> </i>
            </a>
            </div> -->
          </h2>
        </div>
      </div>

      <div class="container content">
        <div class="post">
          <h1 class="post-title">How to scrape data from Google Sheets in R</h1>
          <span class="post-date">2015-06-16</span>
          
<p>Google Forms offers a convenient way to collect data online. It is particularly 
useful because you can embed the form in a webpage, link the results with a 
spreadsheet and publish the results online. This post shows how to scrape the 
data from the spreadsheet (google form) in <code>r</code> using the package <code>RCurl</code>. You 
should be able to follow along by copying and pasting the code into an R 
session. </p>

<p>Ideally you can use this method once you have collected data using a google 
form. For our purposes I just created a google sheet and I will scrape the data 
from there.</p>

<h3>Get some data</h3>

<p>To show how this works, I simulated some data with the following code:</p>

<pre><code class="r"># create fake data
# to save in google sheet

set.seed(1)
df &lt;- data.frame(
    subj = 1:30, 
    group = gl(2, 15, labels = c(&quot;mono&quot;, &quot;bi&quot;)), 
    score = c(rnorm(15, 87, 8), rnorm(15, 94, 3))
    )
</code></pre>

<p>I then copy and pasted the data frame into a google sheet. To do this, open 
google drive and create a new sheet. </p>

<div align="center">
  <img width="400" src="./assets/data.png">
</div>

<p>Once you have some data in a sheet you 
need to do a few things before you are ready to fire up R. </p>

<p>First, you need to publish your sheet to the web (File &gt; Publish to the web...):</p>

<div align="center">
  <img width="400" src="./assets/publish.png">
</div>

<p>Publish the sheet and copy the public link from the window.</p>

<div align="center">
  <img width="400" src="./assets/link.png">
</div>

<p>As you can see, my link is:</p>

<pre><code>https://docs.google.com/spreadsheets/d/1AqS_DAThPUJuS2L2E-S5X7fM1kpIdhXQdBDZUyt-bWM/pubhtml
</code></pre>

<p>Copy your link and save it somewhere. We will 
need it in just a second.</p>

<p>Now we&#39;re ready for R. Here are the packages I used:</p>

<pre><code class="r"># load libraries

library(dplyr); library(tidyr); library(RCurl)
library(ggplot2); library(DT); library(pander)
</code></pre>

<h3>Scrape</h3>

<p>We will use the <code>RCurl</code> package to scrape the data. The command we need is 
<code>getForm()</code>. The first arguement represents the URI to which the form is posted. 
You can just use the one shown below for a google sheet. The important part here 
is the <code>key</code> arguement. You need to copy it from the link you saved above. The 
key can be found in the last part of the link. Here is my link again:</p>

<pre><code>https://docs.google.com/spreadsheets/d/1AqS_DAThPUJuS2L2E-S5X7fM1kpIdhXQdBDZUyt-bWM/pubhtml
</code></pre>

<p>Specifically we want:</p>

<pre><code>1AqS_DAThPUJuS2L2E-S5X7fM1kpIdhXQdBDZUyt-bWM
</code></pre>

<p>Therefore we can delete <code>https://docs.google.com/spreadsheets/d/</code> from the 
beginning, as well as <code>/pubhtml</code> from the end. Check the <code>key</code> arguement below. 
Finally, we use the <code>read.csv()</code> command to import the data.</p>

<pre><code class="r"># scrape data

sheet = getForm(&quot;https://spreadsheets.google.com/spreadsheet/pub&quot;, 
  hl =&quot;en_US&quot;, 
  key = &quot;1AqS_DAThPUJuS2L2E-S5X7fM1kpIdhXQdBDZUyt-bWM&quot;, 
  output = &quot;csv&quot;, 
  .opts = list(followlocation = TRUE, 
               verbose = TRUE, 
               ssl.verifypeer = FALSE)) 

df &lt;- read.csv(textConnection(sheet))
</code></pre>

<p>Let&#39;s see if it worked...</p>

<pre><code class="r">pandoc.table(df, style = &quot;rmarkdown&quot;, round = 2)
</code></pre>

<table><thead>
<tr>
<th align="center">subj</th>
<th align="center">group</th>
<th align="center">score</th>
</tr>
</thead><tbody>
<tr>
<td align="center">1</td>
<td align="center">mono</td>
<td align="center">81.99</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">mono</td>
<td align="center">88.47</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">mono</td>
<td align="center">80.31</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">mono</td>
<td align="center">99.76</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">mono</td>
<td align="center">89.64</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">mono</td>
<td align="center">80.44</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">mono</td>
<td align="center">90.9</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">mono</td>
<td align="center">92.91</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">mono</td>
<td align="center">91.61</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">mono</td>
<td align="center">84.56</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">mono</td>
<td align="center">99.09</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">mono</td>
<td align="center">90.12</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">mono</td>
<td align="center">82.03</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">mono</td>
<td align="center">69.28</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">mono</td>
<td align="center">96</td>
</tr>
<tr>
<td align="center">16</td>
<td align="center">bi</td>
<td align="center">93.87</td>
</tr>
<tr>
<td align="center">17</td>
<td align="center">bi</td>
<td align="center">93.95</td>
</tr>
<tr>
<td align="center">18</td>
<td align="center">bi</td>
<td align="center">96.83</td>
</tr>
<tr>
<td align="center">19</td>
<td align="center">bi</td>
<td align="center">96.46</td>
</tr>
<tr>
<td align="center">20</td>
<td align="center">bi</td>
<td align="center">95.78</td>
</tr>
<tr>
<td align="center">21</td>
<td align="center">bi</td>
<td align="center">96.76</td>
</tr>
<tr>
<td align="center">22</td>
<td align="center">bi</td>
<td align="center">96.35</td>
</tr>
<tr>
<td align="center">23</td>
<td align="center">bi</td>
<td align="center">94.22</td>
</tr>
<tr>
<td align="center">24</td>
<td align="center">bi</td>
<td align="center">88.03</td>
</tr>
<tr>
<td align="center">25</td>
<td align="center">bi</td>
<td align="center">95.86</td>
</tr>
<tr>
<td align="center">26</td>
<td align="center">bi</td>
<td align="center">93.83</td>
</tr>
<tr>
<td align="center">27</td>
<td align="center">bi</td>
<td align="center">93.53</td>
</tr>
<tr>
<td align="center">28</td>
<td align="center">bi</td>
<td align="center">89.59</td>
</tr>
<tr>
<td align="center">29</td>
<td align="center">bi</td>
<td align="center">92.57</td>
</tr>
<tr>
<td align="center">30</td>
<td align="center">bi</td>
<td align="center">95.25</td>
</tr>
</tbody></table>

<p>Looks good. Now we can visualize and analyze the data. </p>

<pre><code class="r">df %&gt;%
  ggplot(., aes(x = as.numeric(group), y = score)) +
  scale_x_discrete(limits = c(2, 1), labels = c(&quot;Bilingual&quot;, &quot;Monolingual&quot;)) +
  geom_jitter() +
  geom_point() +
  geom_smooth(method = &quot;lm&quot;) + 
  labs(x = &quot;Group&quot;, y = &quot;Score&quot;)
</code></pre>

<p><img width="650" src="./assets/plot1.pdf"></p>

<p>And that&#39;s it. </p>

        </div>
        </br>
        </br>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'jvcasillas'; // required: replace example with your forum shortname
        
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
               var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
               dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
               (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
           })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>        
      </div>
      <!-- <a href="#" class="back-to-top">Back to Top</a> -->
    </div>
  
  <script type="text/javascript">
    var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', '53207fc1e32bb4498d004943');
      t.src = '//secure.gaug.es/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>  </body>
  <!-- Load Javascripts for Widgets -->
  
  <!-- LOAD HIGHLIGHTER JS FILES -->
  <script src="../../libraries/highlighters/highlight.js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <!-- DONE LOADING HIGHLIGHTER JS FILES -->
   
  </html>